<!doctype html>
<html lang="en"
      xmlns:th="https://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="fragments/head :: head('Admin panel')"></head>

<body>

<div th:replace="fragments/navbar :: nav"></div>

<div class="container-fluid">
    <div class="row">

        <!-- SIDEBAR -->
        <aside class="col-2 sidebar px-0">
            <div th:replace="fragments/sidebar :: sidebar"></div>
        </aside>

        <!-- CONTENT -->
        <section class="col-10 content-wrap">

            <h1 class="display-5 mb-4">Admin panel</h1>

            <!-- TABS -->
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <button class="nav-link active"
                            data-bs-toggle="tab"
                            data-bs-target="#usersTable"
                            type="button">
                        Users table
                    </button>
                </li>

                <li class="nav-item">
                    <button class="nav-link"
                            data-bs-toggle="tab"
                            data-bs-target="#newUser"
                            type="button">
                        New User
                    </button>
                </li>
            </ul>

            <div class="tab-content border border-top-0 bg-white">

                <!-- ================= USERS TABLE TAB ================= -->
                <div class="tab-pane fade show active p-3" id="usersTable">

                    <h5 class="mb-3">All users</h5>

                    <!-- center table -->
                    <table class="table table-striped align-middle">
                    <thead>
                            <tr>
                                <th>ID</th>
                                <th>First name</th>
                                <th>Last name</th>
                                <th>Age</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Edit</th>
                                <th>Delete</th>
                            </tr>
                            </thead>

                            <tbody>
                            <tr th:each="u : ${users}">
                                <td th:text="${u.id}"></td>
                                <td th:text="${u.name}"></td>
                                <td th:text="${u.surname}"></td>
                                <td th:text="${u.year}"></td>
                                <td th:text="${u.username}"></td>

                                <!-- ROLES -->
                                <td>
                                    <span th:each="r, st : ${u.roles}">
                                        <span th:text="${#strings.replace(r.name,'ROLE_','')}"></span><span th:if="${!st.last}"> </span>
                                    </span>
                                </td>

                                <!-- EDIT -->
                                <td>
                                    <button class="btn btn-info text-white"
                                            data-bs-toggle="modal"
                                            type="button"
                                            th:attr="data-bs-target='#editModal-' + ${u.id}">
                                        Edit
                                    </button>
                                </td>

                                <!-- DELETE -->
                                <td>
                                    <button class="btn btn-danger"
                                            data-bs-toggle="modal"
                                            type="button"
                                            th:attr="data-bs-target='#deleteModal-' + ${u.id}">
                                        Delete
                                    </button>
                                </td>

                                <!-- ================= EDIT MODAL ================= -->
                                <div class="modal fade" th:attr="id='editModal-' + ${u.id}" tabindex="-1">
                                    <div class="modal-dialog">
                                        <div class="modal-content">

                                            <form th:action="@{/admin/users/update}" method="post">
                                                <input type="hidden"
                                                       th:name="${_csrf.parameterName}"
                                                       th:value="${_csrf.token}"/>

                                                <input type="hidden" name="id" th:value="${u.id}"/>

                                                <div class="modal-header">
                                                    <h5 class="modal-title">Edit user</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                                </div>

                                                <div class="modal-body">

                                                    <div class="mb-3 text-center">
                                                        <label class="form-label fw-bold">ID</label>
                                                        <input class="form-control w-50 mx-auto"
                                                               th:value="${u.id}"
                                                               disabled>
                                                    </div>

                                                    <div class="mb-3 text-center">
                                                        <label class="form-label fw-bold">First name</label>
                                                        <input name="name"
                                                               class="form-control w-50 mx-auto"
                                                               th:value="${u.name}">
                                                    </div>

                                                    <div class="mb-3 text-center">
                                                        <label class="form-label fw-bold">Last name</label>
                                                        <input name="surname"
                                                               class="form-control w-50 mx-auto"
                                                               th:value="${u.surname}">
                                                    </div>

                                                    <div class="mb-3 text-center">
                                                        <label class="form-label fw-bold">Age</label>
                                                        <input name="year"
                                                               type="number"
                                                               class="form-control w-50 mx-auto"
                                                               th:value="${u.year}">
                                                    </div>

                                                    <div class="mb-3 text-center">
                                                        <label class="form-label fw-bold">Email</label>
                                                        <input name="username"
                                                               class="form-control w-50 mx-auto"
                                                               th:value="${u.username}">
                                                    </div>

                                                    <div class="mb-3 text-center">
                                                        <label class="form-label fw-bold">Password</label>
                                                        <input name="password"
                                                               type="password"
                                                               class="form-control w-50 mx-auto"
                                                               placeholder=" ">
                                                    </div>

                                                    <div class="mb-3 text-center">
                                                        <label class="form-label fw-bold">Role</label>
                                                        <select class="form-select w-50 mx-auto"
                                                                name="roles"
                                                                multiple
                                                                size="2">

                                                            <option value="ROLE_ADMIN"
                                                                    th:selected="${u.roles.contains(roleAdmin)}">
                                                                ADMIN
                                                            </option>

                                                            <option value="ROLE_USER"
                                                                    th:selected="${u.roles.contains(roleUser)}">
                                                                USER
                                                            </option>

                                                        </select>
                                                    </div>

                                                </div>


                                            <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                                        Close
                                                    </button>
                                                    <button class="btn btn-primary" type="submit">
                                                        Edit
                                                    </button>
                                                </div>

                                            </form>
                                        </div>
                                    </div>
                                </div>

                                <!-- ================= DELETE MODAL ================= -->
                                <div class="modal fade" th:attr="id='deleteModal-' + ${u.id}" tabindex="-1">
                                    <div class="modal-dialog">
                                        <div class="modal-content">

                                            <form th:action="@{/admin/users/delete}" method="post">
                                                <input type="hidden"
                                                       th:name="${_csrf.parameterName}"
                                                       th:value="${_csrf.token}"/>

                                                <input type="hidden" name="id" th:value="${u.id}"/>

                                                <div class="modal-header">
                                                    <h5 class="modal-title">Delete user</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                                </div>

                                                <div class="modal-body">

                                                    <div class="mb-3 text-center">
                                                        <label class="form-label fw-bold">ID</label>
                                                        <input class="form-control w-75 mx-auto"
                                                               th:value="${u.id}"
                                                               disabled>
                                                    </div>

                                                    <div class="mb-3 text-center">
                                                        <label class="form-label fw-bold">First name</label>
                                                        <input class="form-control w-75 mx-auto"
                                                               th:value="${u.name}"
                                                               disabled>
                                                    </div>

                                                    <div class="mb-3 text-center">
                                                        <label class="form-label fw-bold">Last name</label>
                                                        <input class="form-control w-75 mx-auto"
                                                               th:value="${u.surname}"
                                                               disabled>
                                                    </div>

                                                    <div class="mb-3 text-center">
                                                        <label class="form-label fw-bold">Age</label>
                                                        <input class="form-control w-75 mx-auto"
                                                               th:value="${u.year}"
                                                               disabled>
                                                    </div>

                                                    <div class="mb-3 text-center">
                                                        <label class="form-label fw-bold">Email</label>
                                                        <input class="form-control w-75 mx-auto"
                                                               th:value="${u.username}"
                                                               disabled>
                                                    </div>

                                                    <div class="mb-3 text-center">
                                                        <label class="form-label fw-bold">Role</label>
                                                        <select class="form-select w-75 mx-auto"
                                                                multiple
                                                                size="2"
                                                                disabled>
                                                            <option th:each="r : ${u.roles}"
                                                                    th:text="${#strings.replace(r.name,'ROLE_','')}">
                                                            </option>
                                                        </select>
                                                    </div>

                                                </div>

                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                                        Close
                                                    </button>
                                                    <button class="btn btn-danger" type="submit">
                                                        Delete
                                                    </button>
                                                </div>

                                            </form>
                                        </div>
                                    </div>
                                </div>

                            </tr>
                            </tbody>
                        </table>
                    </div> <!-- /center table -->

                </div> <!-- /usersTable -->

                <!-- ================= NEW USER TAB ================= -->
                <div class="tab-pane fade p-3" id="newUser">

                    <div class="card">
                        <div class="card-header fw-bold">
                            Add new user
                        </div>

                        <div class="card-body">

                            <form th:action="@{/admin/users/add}"
                                  method="post"
                                  class="mx-auto"
                                  style="max-width: 420px;">

                                <input type="hidden"
                                       th:name="${_csrf.parameterName}"
                                       th:value="${_csrf.token}"/>

                                <div class="mb-3 text-center">
                                    <label class="form-label fw-bold">First name</label>
                                    <input name="name"
                                           class="form-control w-75 mx-auto"
                                           required>
                                </div>

                                <div class="mb-3 text-center">
                                    <label class="form-label fw-bold">Last name</label>
                                    <input name="surname"
                                           class="form-control w-75 mx-auto">
                                </div>

                                <div class="mb-3 text-center">
                                    <label class="form-label fw-bold">Age</label>
                                    <input name="year"
                                           type="number"
                                           class="form-control w-75 mx-auto">
                                </div>

                                <div class="mb-3 text-center">
                                    <label class="form-label fw-bold">Email</label>
                                    <input name="username"
                                           class="form-control w-75 mx-auto"
                                           required>
                                </div>

                                <div class="mb-3 text-center">
                                    <label class="form-label fw-bold">Password</label>
                                    <input name="password"
                                           type="password"
                                           class="form-control w-75 mx-auto"
                                           required>
                                </div>

                                <div class="mb-4 text-center">
                                    <label class="form-label fw-bold">Role</label>
                                    <select class="form-select w-75 mx-auto"
                                            name="roles"
                                            multiple
                                            size="2">
                                        <option value="ROLE_ADMIN">ADMIN</option>
                                        <option value="ROLE_USER" selected>USER</option>
                                    </select>
                                </div>

                                <div class="text-center">
                                    <button class="btn btn-success px-5" type="submit">
                                        Add new user
                                    </button>
                                </div>

                            </form>

                        </div>
                    </div>

                </div>

        </section>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
